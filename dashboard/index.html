<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å­¸è¨“ç·´è¨ˆç•«ä¸»æŒäººå·¥ä½œåŠ - å ±åç¾æ³å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(-45deg, #1e0338, #4a0d7a, #701a9e, #9c1bc2);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Loading å‹•ç•« */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #d946ef;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen relative p-6 md:p-10">

    <!-- èƒŒæ™¯è£é£¾ -->
    <div class="fixed top-[-10%] left-[-10%] w-96 h-96 bg-fuchsia-600 rounded-full mix-blend-multiply filter blur-[128px] opacity-50 animate-pulse pointer-events-none"></div>
    <div class="fixed bottom-[-10%] right-[-10%] w-96 h-96 bg-blue-600 rounded-full mix-blend-multiply filter blur-[128px] opacity-50 animate-pulse pointer-events-none" style="animation-delay: 2s;"></div>

    <div class="max-w-6xl mx-auto relative z-10">
        <!-- æ¨™é¡Œå€å¡Š -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4 glass-panel p-6 rounded-3xl">
            <div>
                <h1 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-pink-300 to-fuchsia-300">
                    ğŸ“Š å ±åç¾æ³å„€è¡¨æ¿
                </h1>
                <div class="flex flex-wrap items-center gap-3 mt-2">
                    <p class="text-purple-200 font-medium">æ•™å­¸è¨“ç·´è¨ˆç•«ä¸»æŒäººå·¥ä½œåŠ</p>
                    <span id="statusBadge" class="bg-white/10 text-purple-200 border border-white/20 px-3 py-1 rounded-full text-sm font-bold">è®€å–ä¸­...</span>
                </div>
            </div>
            <button onclick="fetchData()" class="bg-white/10 hover:bg-white/20 border border-white/30 transition-colors px-6 py-3 rounded-full font-bold flex items-center gap-2">
                ğŸ”„ é‡æ–°æ•´ç†
            </button>
        </div>

        <!-- è¼‰å…¥ä¸­ç•«é¢ -->
        <div id="loading" class="flex flex-col items-center justify-center py-20">
            <div class="loader mb-4"></div>
            <p class="text-purple-200 font-bold animate-pulse">æ­£åœ¨å¾ Google Sheets è¼‰å…¥æœ€æ–°è³‡æ–™...</p>
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯ç•«é¢ -->
        <div id="errorMsg" class="hidden bg-red-500/20 border border-red-500/50 text-red-100 p-6 rounded-2xl text-center backdrop-blur-md">
            <h3 class="text-xl font-bold mb-2">âš ï¸ è³‡æ–™è®€å–å¤±æ•—</h3>
            <p id="errorText">è«‹ç¢ºèªæ‚¨çš„ Google Sheets å…±ç”¨è¨­å®šå·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…çš†å¯æŸ¥çœ‹ã€ã€‚</p>
        </div>

        <!-- å„€è¡¨æ¿å…§å®¹ (é è¨­éš±è—ï¼Œè¼‰å…¥å¾Œé¡¯ç¤º) -->
        <div id="dashboardContent" class="hidden space-y-8">
            
            <!-- é ‚éƒ¨æ•¸æ“šå¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ç¸½å ±åäººæ•¸ -->
                <div class="glass-panel p-6 rounded-3xl flex items-center gap-6 transform transition hover:scale-105">
                    <div class="text-5xl bg-gradient-to-br from-fuchsia-400 to-purple-600 w-20 h-20 rounded-2xl flex items-center justify-center shadow-lg">ğŸ‘¥</div>
                    <div>
                        <p class="text-purple-200 text-sm font-bold mb-1">ç¸½å ±åäººæ•¸</p>
                        <div class="flex items-baseline gap-2">
                            <p class="text-4xl font-black" id="totalCount">0</p>
                            <p class="text-xl text-purple-300 font-bold">/ 4</p>
                        </div>
                    </div>
                </div>
                <!-- å¯¦é«”åƒèˆ‡äººæ•¸ -->
                <div class="glass-panel p-6 rounded-3xl flex items-center gap-6 transform transition hover:scale-105">
                    <div class="text-5xl bg-gradient-to-br from-blue-400 to-indigo-600 w-20 h-20 rounded-2xl flex items-center justify-center shadow-lg">ğŸ¢</div>
                    <div>
                        <p class="text-purple-200 text-sm font-bold mb-1">å¯¦é«”åƒèˆ‡</p>
                        <p class="text-4xl font-black" id="physicalCount">0</p>
                    </div>
                </div>
                <!-- ç·šä¸Šåƒèˆ‡äººæ•¸ -->
                <div class="glass-panel p-6 rounded-3xl flex items-center gap-6 transform transition hover:scale-105">
                    <div class="text-5xl bg-gradient-to-br from-green-400 to-emerald-600 w-20 h-20 rounded-2xl flex items-center justify-center shadow-lg">ğŸŒ</div>
                    <div>
                        <p class="text-purple-200 text-sm font-bold mb-1">ç·šä¸Šåƒèˆ‡</p>
                        <p class="text-4xl font-black" id="onlineCount">0</p>
                    </div>
                </div>
            </div>

            <!-- åœ–è¡¨å€å¡Š -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- åƒèˆ‡æ–¹å¼åœ“é¤…åœ– -->
                <div class="glass-panel p-6 rounded-3xl flex flex-col items-center">
                    <h3 class="text-lg font-bold text-purple-200 mb-6 text-center w-full border-b border-white/10 pb-4">ğŸ’» åƒèˆ‡æ–¹å¼åˆ†ä½ˆ</h3>
                    <div class="relative w-full aspect-square max-w-[280px]">
                        <canvas id="participationChart"></canvas>
                    </div>
                </div>

                <!-- è¨ˆç•«ä¸»æŒäººæ¯”ä¾‹ -->
                <div class="glass-panel p-6 rounded-3xl flex flex-col items-center">
                    <h3 class="text-lg font-bold text-purple-200 mb-6 text-center w-full border-b border-white/10 pb-4">ğŸ‘‘ è¨ˆç•«ä¸»æŒäººæ¯”ä¾‹</h3>
                    <div class="relative w-full aspect-square max-w-[280px]">
                        <canvas id="directorChart"></canvas>
                    </div>
                </div>

                <!-- è² è²¬è·é¡é•·æ¢åœ– (ä½”æ“šå…©æ ¼æˆ–ä¸€æ ¼) -->
                <div class="glass-panel p-6 rounded-3xl lg:col-span-3">
                    <h3 class="text-lg font-bold text-purple-200 mb-6 border-b border-white/10 pb-4">ğŸ“‹ è² è²¬è·é¡çµ±è¨ˆ</h3>
                    <div class="relative w-full h-64 md:h-80">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Google Sheet è¨­å®š
        const sheetId = '12PkIByUr-lJmVOwj854h6YS6QqG8yqsIlhIPRy00HJU';
        const sheetName = encodeURIComponent('å·¥ä½œåŠå ±åè³‡æ–™');
        // ä½¿ç”¨ Google Visualization API ç›´æ¥è®€å–å…¬é–‹è©¦ç®—è¡¨
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

        // Chart å¯¦ä¾‹å­˜å„²ï¼Œæ–¹ä¾¿æ›´æ–°æ™‚éŠ·æ¯€èˆŠåœ–è¡¨
        let charts = {};

        // é€šç”¨çš„ Chart.js æ–‡å­—èˆ‡é¡è‰²è¨­å®š
        Chart.defaults.color = '#e9d5ff'; // purple-200
        Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
        const chartColors = ['#d946ef', '#3b82f6', '#10b981', '#f59e0b', '#6366f1', '#ec4899', '#8b5cf6', '#14b8a6', '#f43f5e', '#84cc16'];

        async function fetchData() {
            // åˆ‡æ› UI ç‹€æ…‹
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('errorMsg').classList.add('hidden');

            try {
                const response = await fetch(url);
                const text = await response.text();
                
                // Google Visualization API æœƒå›å‚³ /*O_o*/ é–‹é ­çš„å­—ä¸²ï¼Œéœ€æ“·å–å‡º JSON
                const jsonString = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                const data = JSON.parse(jsonString);
                
                // è™•ç†è³‡æ–™
                processData(data.table.rows);

                // é¡¯ç¤ºå„€è¡¨æ¿
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('dashboardContent').classList.remove('hidden');

            } catch (error) {
                console.error("è³‡æ–™è®€å–å¤±æ•—ï¼š", error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('errorMsg').classList.remove('hidden');
            }
        }

        function processData(rows) {
            let total = 0;
            let physical = 0;
            let online = 0;
            
            let participationCounts = { 'å¯¦é«”': 0, 'ç·šä¸Š': 0 };
            let directorCounts = { 'æ˜¯': 0, 'å¦': 0 };
            let categoryCounts = {};

            // ä¾æ“šè¡¨é ­é †åºï¼š0:æ™‚é–“, 1:å§“å, 2:æ©Ÿæ§‹, 3:è·ç¨±, 4:è·é¡, 5:ä¸»æŒäºº, 6:åƒèˆ‡æ–¹å¼, 7:Email, 8:é›»è©±
            rows.forEach(row => {
                // å¦‚æœç¬¬ä¸€æ¬„(æ™‚é–“)æˆ–ç¬¬äºŒæ¬„(å§“å)ç‚ºç©ºï¼Œä»£è¡¨å¯èƒ½æ˜¯ç©ºè¡Œï¼Œè·³é
                if (!row.c || !row.c[0] || !row.c[1] || !row.c[1].v) return;
                
                total++;

                const category = row.c[4] ? row.c[4].v : 'æœªå¡«å¯«';
                const isDirector = row.c[5] ? row.c[5].v : 'æœªå¡«å¯«';
                const participation = row.c[6] ? row.c[6].v : 'æœªå¡«å¯«';

                // è¨ˆç®—åƒèˆ‡æ–¹å¼
                if (participation.includes('å¯¦é«”')) { physical++; participationCounts['å¯¦é«”']++; }
                else if (participation.includes('ç·šä¸Š')) { online++; participationCounts['ç·šä¸Š']++; }

                // è¨ˆç®—ä¸»æŒäºº
                if (isDirector.includes('æ˜¯') || isDirector === 'yes') directorCounts['æ˜¯']++;
                else directorCounts['å¦']++;

                // è¨ˆç®—è·é¡
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });

            // æ›´æ–°æ•¸å­— UI èˆ‡ é¡æ»¿ç‹€æ…‹
            document.getElementById('totalCount').innerText = total;
            document.getElementById('physicalCount').innerText = physical;
            document.getElementById('onlineCount').innerText = online;
            
            const statusBadge = document.getElementById('statusBadge');
            if (total >= 4) {
                statusBadge.innerText = 'ğŸ”´ å·²é¡æ»¿';
                statusBadge.className = 'bg-red-500/20 text-red-300 border border-red-500/50 px-3 py-1 rounded-full text-sm font-bold animate-pulse';
            } else {
                statusBadge.innerText = 'ğŸŸ¢ é–‹æ”¾å ±åä¸­';
                statusBadge.className = 'bg-green-500/20 text-green-300 border border-green-500/50 px-3 py-1 rounded-full text-sm font-bold';
            }

            // ç¹ªè£½åœ–è¡¨
            renderParticipationChart(participationCounts);
            renderDirectorChart(directorCounts);
            renderCategoryChart(categoryCounts);
        }

        function createOrUpdateChart(chartId, config) {
            const ctx = document.getElementById(chartId).getContext('2d');
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            charts[chartId] = new Chart(ctx, config);
        }

        function renderParticipationChart(data) {
            createOrUpdateChart('participationChart', {
                type: 'doughnut',
                data: {
                    labels: ['å¯¦é«”åƒèˆ‡', 'ç·šä¸Šåƒèˆ‡'],
                    datasets: [{
                        data: [data['å¯¦é«”'], data['ç·šä¸Š']],
                        backgroundColor: ['#3b82f6', '#10b981'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    cutout: '70%'
                }
            });
        }

        function renderDirectorChart(data) {
            createOrUpdateChart('directorChart', {
                type: 'pie',
                data: {
                    labels: ['æ˜¯è¨ˆç•«ä¸»æŒäºº', 'å°šæœªæ“”ä»»'],
                    datasets: [{
                        data: [data['æ˜¯'], data['å¦']],
                        backgroundColor: ['#d946ef', '#f472b6'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function renderCategoryChart(data) {
            // æ’åºè·é¡ï¼Œç”±é«˜åˆ°ä½
            const sortedCategories = Object.keys(data).sort((a, b) => data[b] - data[a]);
            const values = sortedCategories.map(cat => data[cat]);

            createOrUpdateChart('categoryChart', {
                type: 'bar',
                data: {
                    labels: sortedCategories,
                    datasets: [{
                        label: 'å ±åäººæ•¸',
                        data: values,
                        backgroundColor: chartColors,
                        borderRadius: 8,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æŠ“å–è³‡æ–™
        window.onload = fetchData;
    </script>
</body>
</html>
